<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="group">

	<resultMap id="GroupVo" type="com.lunchwb.vo.GroupVo">
		<result column="group_no" property="groupNo" />
		<result column="group_leader" property="groupLeader" />
		<result column="group_name" property="groupName" />
		<result column="group_member_no" property="groupMemberNo" />
		<result column="user_no" property="userNo" />
		<result column="leader_check" property="leaderCheck" />
		<result column="boss_check" property="bossCheck" />
		<result column="user_name" property="userName" />
		<result column="user_birth_year" property="userBirthYear" />
		<result column="user_sex" property="userSex" />
	</resultMap>	


	<!-- 그룹 리스트 -->
	<select id="userGroups" parameterType="int" resultMap="GroupVo">
		SELECT  g.group_no,
				g.group_name
		FROM groups g, group_member m
		WHERE g.group_no = m.group_no
		AND user_no = #{userNo}
		ORDER BY group_member_no ASC;
	</select>


	<!-- 그룹 멤버 리스트 -->
	<select id="groupMembers" parameterType="int" resultMap="GroupVo">
		SELECT  group_member_no,
		        u.user_no,
		        group_no
		        leader_check,
		        boss_check,
		        user_name,
		        user_birth_year,
		        user_sex
		FROM group_member m, users u
		WHERE m.user_no = u.user_no
		AND group_no = 1
		ORDER BY boss_check DESC,
		         group_member_no ASC
	</select>


	<!-- 그룹 생성 -->
	<insert id="createGroup" parameterType="GroupVo">
		<selectKey keyProperty="groupNo" resultType="int" order="BEFORE">
			SELECT SEQ_GROUP_NO.NEXTVAL FROM DUAL
		</selectKey>
		INSERT INTO GROUPS
		VALUES (#{groupNo}, #{groupLeader}, #{groupName})
	</insert>
	
	
	<!-- 그룹 개수 -->
	<select id="groupCount" parameterType="int" resultType="int">
		SELECT COUNT(group_no)
		FROM group_member
		WHERE user_no = #{userNo}
	</select>
	
	
	<!-- 그룹원 추가 -->
	<insert id="addMember" parameterType="GroupVo">
		INSERT INTO GROUP_MEMBER
		VALUES (SEQ_GROUP_MEMBER_NO.NEXTVAL, #{userNo}, #{groupNo}, 
				#{leaderCheck}, #{bossCheck}, #{groupOrder})
	</insert>

</mapper>